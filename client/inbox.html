<!doctype html>
<html>
<head><meta charset="utf-8"><title>我的邮箱</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="/js/common.js"></script>
</head>
<body>
<div id="topnav" style="background:#f5f5f5;padding:8px;border-bottom:1px solid #ddd;">
  <a href="/">登录</a>
  <a href="/index.html" data-protect="auth" style="margin-left:12px">商品列表</a>
  <a href="/cart.html" data-protect="auth" style="margin-left:12px">购物车</a>
  <a id="ordersLink" href="/orders.html" data-protect="auth" style="margin-left:12px;display:none">我的订单</a>
  <a id="logoutLink" href="#" style="margin-left:12px;display:none">注销</a>
</div>

<h2>我的邮箱</h2>
<div id="msg"></div>
<table border="1" cellpadding="6" style="width:100%;border-collapse:collapse;margin-top:8px"><thead><tr><th>时间</th><th>主题</th><th>内容</th></tr></thead>
<tbody id="list"></tbody></table>

<script>
async function load(){
  const token = localStorage.getItem('token');
  if (!token) return location.href = '/';
  try{
    const res = await fetch('/api/messages', { headers: { Authorization: 'Bearer ' + token }});
    if (!res.ok) return document.getElementById('msg').innerText = '无法获取消息';
    const rows = await res.json();
    document.getElementById('list').innerHTML = rows.map(r => `
      <tr>
        <td>${r.created_at}</td>
        <td>${r.subject}</td>
        <td>${r.body}</td>
      </tr>
    `).join('');
  }catch(e){ document.getElementById('msg').innerText = '错误'; }
}
load();
</script>
</body>
</html>